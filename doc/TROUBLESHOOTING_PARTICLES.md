# 粒子特效问题排查指南

## 问题：看不到粒子效果

### 可能原因和解决方案

#### 1. 视频未加载
**症状**：页面显示"加载中..."或黑屏

**检查**：
- 打开浏览器控制台（F12），查看是否有错误
- 检查视频文件路径是否正确
- 确认视频文件在 `public/videos/` 目录下

**解决**：
```typescript
// 检查视频路径
console.log('视频路径:', videoSrc)
// 确认文件存在
```

#### 2. 视频需要用户交互才能播放
**症状**：视频加载完成但不播放

**解决**：
- 点击"播放"按钮
- 某些浏览器需要用户交互才能自动播放

#### 3. 粒子数量过多导致性能问题
**症状**：页面卡顿或白屏

**检查**：
- 查看控制台中的粒子数量日志
- `step=1` 会产生约 57,600 个粒子（可能过多）

**解决**：
```tsx
<AdvancedVideoParticle
  step={3}  // 改为 3，约 6,400 个粒子
  // 或
  step={5}  // 改为 5，约 2,304 个粒子
/>
```

#### 4. MediaPipe 初始化失败
**症状**：粒子显示但没有人物/背景区分

**检查**：
- 查看控制台是否有 "MediaPipe 初始化失败" 错误
- 检查网络连接（需要从 CDN 加载模型）

**解决**：
- 等待模型加载完成（首次使用约 2-3 MB）
- 检查网络连接
- 即使 MediaPipe 失败，基础粒子效果仍应显示

#### 5. Canvas 上下文创建失败
**症状**：显示错误提示

**检查**：
- 浏览器是否支持 Canvas
- 是否有其他错误

**解决**：
- 使用现代浏览器（Chrome/Edge/Firefox）
- 检查浏览器控制台错误

#### 6. Three.js 渲染问题
**症状**：黑屏或白屏

**检查**：
- 查看控制台是否有 WebGL 错误
- 检查显卡驱动是否最新

**解决**：
- 更新浏览器
- 更新显卡驱动
- 尝试其他浏览器

## 调试步骤

### 步骤 1：检查控制台
打开浏览器控制台（F12），查看：
- 是否有错误信息
- 是否有 "粒子系统创建" 日志
- 是否有 "MediaPipe 初始化成功" 日志

### 步骤 2：检查视频
```typescript
// 在组件中添加
console.log('视频状态:', {
  src: videoSrc,
  readyState: video?.readyState,
  paused: video?.paused,
  error: video?.error
})
```

### 步骤 3：检查粒子数量
```typescript
// 查看粒子数量
const count = Math.floor((width / step) * (height / step))
console.log('粒子数量:', count)
// 如果 > 15,000，可能性能问题
```

### 步骤 4：简化测试
使用基础版本测试：
```tsx
// 先测试基础版本
<VideoParticle
  videoSrc={currentVideo}
  width={320}
  height={180}
  step={3}
  particleSize={2}
/>
```

## 常见错误信息

### "无法创建 Canvas 上下文"
- 浏览器不支持 Canvas
- 解决方案：使用现代浏览器

### "视频加载失败"
- 视频文件不存在或路径错误
- 解决方案：检查文件路径，确认文件存在

### "MediaPipe 初始化失败"
- 网络问题或 CDN 不可访问
- 解决方案：检查网络，等待重试

### "分割失败"
- MediaPipe 处理出错
- 解决方案：检查视频格式，尝试其他视频

## 性能优化建议

### 如果粒子太多
```tsx
// 减少粒子数量
step={5}  // 从 3 改为 5
width={240}  // 从 320 改为 240
height={135}  // 从 180 改为 135
```

### 如果 MediaPipe 太慢
- 已经是节流控制（10 FPS）
- 可以进一步降低到 5 FPS（200ms）

## 测试清单

- [ ] 视频文件存在且路径正确
- [ ] 浏览器控制台无错误
- [ ] 粒子数量合理（< 15,000）
- [ ] 点击播放按钮
- [ ] 等待 MediaPipe 模型加载
- [ ] 检查网络连接

## 快速测试

使用最简单的配置测试：

```tsx
<AdvancedVideoParticle
  videoSrc="/videos/test.mp4"
  width={160}      // 降低分辨率
  height={90}      // 降低分辨率
  step={5}         // 增大步长
  particleSize={3} // 增大粒子
/>
```

这样可以快速验证功能是否正常。
