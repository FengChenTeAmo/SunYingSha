(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[421],{5848:function(e,t,n){Promise.resolve().then(n.bind(n,8862))},8862:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return h}});var r=n(7437),s=n(2265),a=n(2079),l=n(1448);function o(e){if(e.startsWith("http://")||e.startsWith("https://"))return e;let t="";if(!(t=window.__NEXT_PUBLIC_BASE_PATH__||"")){let e=window.__NEXT_DATA__;t=(null==e?void 0:e.assetPrefix)||(null==e?void 0:e.basePath)||""}if(!t&&window.location.pathname){let e=window.location.pathname.match(/^(\/SunYingSha)/);e&&(t=e[1])}let n=e.startsWith("/")?e:"/".concat(e);if(t){let e=t.endsWith("/")&&"/"!==t?t.slice(0,-1):t;return"".concat(e).concat(n)}return n}function i(e){let{videoSrc:t,width:i=320,height:c=180,particleSize:d=2,className:u="",onVideoEnd:m}=e,h=(0,s.useRef)(null),x=(0,s.useRef)(null),f=(0,s.useRef)(null),p=(0,s.useRef)(null),v=(0,s.useRef)(null),w=(0,s.useRef)(null),g=(0,s.useRef)(null),b=(0,s.useRef)(null),y=(0,s.useRef)(),j=(0,s.useRef)(null),N=(0,s.useRef)(null),M=(0,s.useRef)(null),A=(0,s.useRef)(null),E=(0,s.useRef)(null),R=(0,s.useRef)(null),S=(0,s.useRef)(null),T=(0,s.useRef)(null),C=(0,s.useRef)(null),I=(0,s.useRef)(null),P=(0,s.useRef)(0),_=(0,s.useRef)(null),[k,D]=(0,s.useState)(!1),[q,F]=(0,s.useState)(!0),[W,L]=(0,s.useState)(null),[z,B]=(0,s.useState)(!1),[Q,O]=(0,s.useState)({width:0,height:0});return(0,s.useEffect)(()=>{let e,t;if(!h.current||!x.current)return;(async()=>{try{let{SelfieSegmentation:e}=await n.e(784).then(n.t.bind(n,4987,23)),t=new e({locateFile:e=>"https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/".concat(e)});t.setOptions({modelSelection:1}),t.onResults(e=>{e.segmentationMask&&(I.current=e.segmentationMask,B(!0),console.log("MediaPipe mask 已更新"))}),C.current=t,console.log("MediaPipe 初始化成功")}catch(e){console.warn("MediaPipe 不可用，将使用基础粒子效果")}})();let r=new a.xsS;f.current=r;let s=i/c;window.innerWidth/window.innerHeight>s?e=Math.floor((t=Math.floor(.5*window.innerHeight*.8))*s):t=Math.floor((e=Math.floor(.5*window.innerWidth*.8))/s),O({width:e=Math.floor(e),height:t=Math.floor(t)});let o=new a.cPb(45,e/t,1,1e3);o.position.z=400,p.current=o;let u=new l.CP7({antialias:!0});u.setSize(e,t),u.setClearColor(0,1),h.current.appendChild(u.domElement),v.current=u;let m=document.createElement("canvas");m.width=i,m.height=c;let k=m.getContext("2d",{willReadFrequently:!0});if(!k){L("无法创建视频 Canvas 上下文");return}j.current=m,N.current=k;let D=document.createElement("canvas");D.width=i,D.height=c;let q=D.getContext("2d",{willReadFrequently:!0});if(!q){L("无法创建 Mask Canvas 上下文");return}M.current=D,A.current=q;let W=Math.floor(e/d),z=Math.floor(t/d),Q=W*z;console.log("创建 GPU Shader 粒子系统: ".concat(Q," 个粒子 (").concat(W,"x").concat(z,")，Canvas: ").concat(e,"x").concat(t));let U=new a.u9r;g.current=U;let V=new Float32Array(3*Q),H=new Float32Array(3*Q),G=new Float32Array(Q),X=new Float32Array(2*Q);T.current=X;let K=0;for(let n=0;n<z;n++)for(let r=0;r<W;r++)V[3*K]=(r/W-.5)*e,V[3*K+1]=(.5-n/z)*t,V[3*K+2]=0,X[2*K]=r/W*i,X[2*K+1]=n/z*c,H[3*K]=1,H[3*K+1]=1,H[3*K+2]=1,G[K]=0,K++;U.setAttribute("position",new a.TlE(V,3)),U.setAttribute("color",new a.TlE(H,3)),U.setAttribute("aIsPerson",new a.TlE(G,1)),E.current=H,R.current=V,S.current=G,g.current.userData={gridWidth:W,gridHeight:z,count:Q};let Y=new a.jyz({uniforms:{},vertexShader:"\nattribute float aIsPerson;\n\nvarying vec3 vColor;\nvarying float vIsPerson;\n\nvoid main() {\n  vColor = color;\n  vIsPerson = aIsPerson;\n\n  vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix * mvPosition;\n\n  // 统一粒子尺寸，避免视觉上的颜色变化\n  gl_PointSize = 3.0;\n}\n",fragmentShader:"\nprecision mediump float;\n\nvarying vec3 vColor;\nvarying float vIsPerson;\n\nvoid main() {\n  // 圆形粒子（可选，更柔和）\n  vec2 coord = gl_PointCoord - vec2(0.5);\n  if (dot(coord, coord) > 0.25) discard;\n\n  // 统一透明度，避免颜色视觉变化\n  float alpha = 1.0;\n\n  // 直接使用顶点颜色，不做任何调整\n  gl_FragColor = vec4(vColor, alpha);\n}\n",transparent:!0,depthTest:!0,depthWrite:!1,vertexColors:!0,side:a.ehD});b.current=Y;let J=new a.woe(U,Y);r.add(J),w.current=J;let Z=x.current,$=()=>{console.log("视频数据已加载"),F(!1),L(null)},ee=()=>{F(!1)},et=e=>{let t=Z.error,n="视频加载失败，请检查视频路径";if(t)switch(t.code){case t.MEDIA_ERR_ABORTED:n="视频加载被中止";break;case t.MEDIA_ERR_NETWORK:n="网络错误，无法加载视频";break;case t.MEDIA_ERR_DECODE:n="视频解码失败";break;case t.MEDIA_ERR_SRC_NOT_SUPPORTED:n="视频格式不支持"}L(n),F(!1)};async function en(e){if(!e.videoWidth||!C.current)return;let t=performance.now();if(t-P.current>100)try{await C.current.send({image:e}),P.current=t}catch(e){var n,r;((null==e?void 0:null===(n=e.message)||void 0===n?void 0:n.includes("Aborted"))||(null==e?void 0:null===(r=e.message)||void 0===r?void 0:r.includes("Module")))&&(console.warn("MediaPipe 运行时错误，将使用基础粒子效果"),C.current=null)}}Z.addEventListener("loadeddata",$),Z.addEventListener("canplay",ee),Z.addEventListener("error",et),function e(){y.current=requestAnimationFrame(e);let t=N.current,n=p.current,r=v.current,s=f.current,a=g.current;if(r&&s&&n){if(Z&&!Z.paused&&Z.readyState>=2&&en(Z),Z&&Z.readyState>=2&&t&&a&&E.current&&R.current&&S.current)try{var l;t.clearRect(0,0,i,c),t.drawImage(Z,0,0,i,c);let e=t.getImageData(0,0,i,c).data,n=null;if(_.current){n=new Float32Array(i*c);for(let t=0;t<c;t++)for(let r=0;r<i;r++){let s=(t*i+r)*4,a=Math.abs(e[s]-_.current[s]),l=Math.abs(e[s+1]-_.current[s+1]),o=Math.abs(e[s+2]-_.current[s+2]),c=(a+l+o)/765>.1?1:0;n[t*i+r]=c}}_.current=new Uint8ClampedArray(e);let r=null,s=A.current;if(I.current&&s){let e=I.current;s.clearRect(0,0,i,c),s.drawImage(e,0,0,i,c),r=s.getImageData(0,0,i,c).data}let o=E.current,d=R.current,u=S.current,m=T.current;if(!m||!a)return;let h=(null===(l=a.userData)||void 0===l?void 0:l.count)||0;if(0===h)return;for(let t=0;t<h;t++){let s=Math.floor(m[2*t]),a=Math.floor(m[2*t+1]),l=Math.max(0,Math.min(s,i-1)),h=Math.max(0,Math.min(a,c-1)),x=(h*i+l)*4;e[x],e[x+1],e[x+2];let f=r&&r[x]>128?1:0;u[t]=f;let p=n?n[h*i+l]:0;1===p?o[3*t]=1:o[3*t]=0,o[3*t+1]=0,o[3*t+2]=0,f>.5?d[3*t+2]=100:d[3*t+2]=-150}if(a.attributes.color.needsUpdate=!0,a.attributes.position.needsUpdate=!0,a.attributes.aIsPerson.needsUpdate=!0,.016>Math.random()&&n){let e=0;for(let t=0;t<n.length;t++)1===n[t]&&e++;console.log("运动检测统计:",{totalParticles:n.length,motionParticles:e,motionRatio:(e/n.length*100).toFixed(1)+"%",motionType:"二值化（0=静止，1=运动）"})}}catch(e){e instanceof Error&&!e.message.includes("cross-origin")&&console.warn("视频帧处理错误:",e)}r.render(s,n)}}();let er=()=>{let e,t;let n=p.current,r=v.current;if(!n||!r)return;let s=i/c;window.innerWidth/window.innerHeight>s?e=Math.floor((t=Math.floor(.5*window.innerHeight*.8))*s):t=Math.floor((e=Math.floor(.5*window.innerWidth*.8))/s),O({width:e=Math.floor(e),height:t=Math.floor(t)}),n.aspect=e/t,n.updateProjectionMatrix(),r.setSize(e,t)};return window.addEventListener("resize",er),()=>{let e=x.current;e&&(e.removeEventListener("loadeddata",$),e.removeEventListener("canplay",ee),e.removeEventListener("error",et),e.pause(),e.src="",e.load()),window.removeEventListener("resize",er),y.current&&cancelAnimationFrame(y.current);let t=N.current,n=A.current;if(t&&t.clearRect(0,0,i,c),n&&n.clearRect(0,0,i,c),u&&u.domElement.parentNode&&u.domElement.parentNode.removeChild(u.domElement),u&&u.dispose(),U&&U.dispose(),Y&&Y.dispose(),C.current)try{C.current.close()}catch(e){console.warn("关闭分割器失败:",e)}_.current=null,I.current=null}},[i,c,d]),(0,s.useEffect)(()=>{let e=x.current,n=o(t);if(e&&e.src!==n){e.pause(),e.currentTime=0;let t=N.current,r=A.current;t&&t.clearRect(0,0,i,c),r&&r.clearRect(0,0,i,c),_.current=null,I.current=null,F(!0),L(null),D(!1),e.src=n,e.load()}},[t,i,c]),(0,s.useEffect)(()=>{let e=x.current;!e||k||q||W||e.play().catch(e=>{console.warn("自动播放失败，需要用户交互:",e)})},[q,W,k]),(0,s.useEffect)(()=>{let e=x.current;if(!e)return;let t=()=>D(!0),n=()=>D(!1),r=()=>{D(!1),e&&e.pause(),m&&m()};return e.addEventListener("play",t),e.addEventListener("pause",n),e.addEventListener("ended",r),()=>{e.removeEventListener("play",t),e.removeEventListener("pause",n),e.removeEventListener("ended",r)}},[m]),(0,r.jsxs)("div",{className:"relative ".concat(u),style:{width:"".concat(Q.width,"px"),height:"".concat(Q.height,"px"),margin:"0 auto"},children:[(0,r.jsx)("div",{ref:h,className:"absolute inset-0"}),(0,r.jsx)("video",{ref:x,src:o(t),className:"hidden",muted:!0,playsInline:!0,preload:"auto",autoPlay:!0}),q&&(0,r.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/50 z-10",children:[(0,r.jsx)("div",{className:"text-white text-lg mb-2",children:"加载中..."}),(0,r.jsx)("div",{className:"text-white/60 text-sm",children:"正在初始化 GPU Shader 和 MediaPipe"})]}),W&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 z-10",children:(0,r.jsxs)("div",{className:"text-red-400 text-center px-4",children:[(0,r.jsx)("p",{className:"text-lg mb-2",children:"错误"}),(0,r.jsx)("p",{className:"text-sm",children:W})]})})]})}function c(e){let{question:t,questionIndex:n,totalQuestions:a,isVisible:l,onAnswer:o,onClose:i,previousAnswer:c,isAnswered:d=!1}=e,[u,m]=(0,s.useState)(null!=c?c:null),[h,x]=(0,s.useState)(d),[f,p]=(0,s.useState)(!!d&&void 0!==c&&c===t.correctAnswer);(0,s.useEffect)(()=>{l&&(d&&void 0!==c?(m(c),x(!0),p(c===t.correctAnswer)):(m(null),x(!1),p(!1)))},[l,t.id,d,c]);let v=e=>{if(d||null!==u)return;m(e);let n=e===t.correctAnswer;p(n),x(!0),o(e,n)};return l?(0,r.jsx)("div",{className:"w-full p-6 animate-fadeIn",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-4xl w-full mx-auto shadow-2xl border-2 border-gray-200",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-500 mb-2",children:["问题 ",n+1,"/",a]}),(0,r.jsx)("h2",{className:"text-2xl font-bold mb-6 text-gray-800",children:t.question}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:t.options.map((e,n)=>{let s=u===n,a=n===t.correctAnswer,l="p-4 border-2 rounded-lg text-left transition-all font-medium";return h?a?l+=" border-green-500 bg-green-50 text-green-800":s&&!a?l+=" border-red-500 bg-red-50 text-red-800":l+=" border-gray-200 bg-gray-50 opacity-50":l+=" border-gray-300 bg-white hover:bg-gray-50 hover:border-blue-400 cursor-pointer",(0,r.jsx)("button",{onClick:()=>v(n),disabled:null!==u,className:l,children:e},n)})}),h&&(0,r.jsxs)("div",{className:"p-4 rounded-lg ".concat(f?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:[f?(0,r.jsx)("p",{className:"font-bold text-lg",children:"✓ 回答正确！+1分"}):(0,r.jsxs)("p",{className:"font-bold text-lg",children:["✗ 回答错误，正确答案是：",t.options[t.correctAnswer]]}),t.explanation&&(0,r.jsx)("p",{className:"mt-2 text-sm",children:t.explanation})]})]})}):null}function d(e){let{score:t,totalQuestions:n,elapsedTime:s}=e;return(0,r.jsx)("div",{className:"absolute top-4 right-4 z-30 bg-black/70 backdrop-blur-md rounded-lg p-4 text-white",children:(0,r.jsxs)("div",{className:"flex items-center gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-gray-400 mb-1",children:"得分"}),(0,r.jsxs)("div",{className:"text-2xl font-bold",children:[t,(0,r.jsxs)("span",{className:"text-sm text-gray-400",children:["/",n]})]})]}),(0,r.jsx)("div",{className:"h-12 w-px bg-white/20"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-gray-400 mb-1",children:"时间"}),(0,r.jsx)("div",{className:"text-xl font-bold",children:"".concat(Math.floor(s/60).toString().padStart(2,"0"),":").concat(Math.floor(s%60).toString().padStart(2,"0"))})]})]})})}function u(e){let{isVisible:t,totalTime:n,score:s,totalQuestions:a,correctAnswers:l,onRestart:o}=e;if(!t)return null;let i=a>0?(l/a*100).toFixed(1):"0",c=(()=>{let e=parseFloat(i);return e>=90?{text:"优秀",stars:"⭐⭐⭐⭐⭐",color:"text-yellow-500"}:e>=80?{text:"良好",stars:"⭐⭐⭐⭐",color:"text-blue-500"}:e>=60?{text:"一般",stars:"⭐⭐⭐",color:"text-green-500"}:{text:"加油",stars:"⭐⭐",color:"text-gray-500"}})();return(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm animate-fadeIn",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-8 max-w-md w-full mx-4 shadow-2xl transform -translate-y-0",children:[(0,r.jsx)("div",{className:"text-center mb-6",children:(0,r.jsx)("h2",{className:"text-4xl font-bold mb-2",children:"\uD83C\uDF89 游戏结束 \uD83C\uDF89"})}),(0,r.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"总时长："}),(0,r.jsx)("span",{className:"font-bold text-lg",children:"".concat(Math.floor(n/60).toString().padStart(2,"0"),":").concat(Math.floor(n%60).toString().padStart(2,"0"))})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"总得分："}),(0,r.jsxs)("span",{className:"font-bold text-lg",children:[s,"/",a]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"正确题数："}),(0,r.jsxs)("span",{className:"font-bold text-lg",children:[l,"/",a]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"正确率："}),(0,r.jsxs)("span",{className:"font-bold text-lg",children:[i,"%"]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center pt-4",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"等级："}),(0,r.jsxs)("span",{className:"font-bold text-2xl ".concat(c.color),children:[c.text," ",c.stars]})]})]}),(0,r.jsx)("button",{onClick:o,className:"w-full py-3 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600 transition-colors text-lg",children:"重新开始游戏"})]})})}let m=[{id:1,name:"孙颖莎 vs 王曼昱",src:"/videos/sample1.mp4",duration:30,opponent:"王曼昱",matchInfo:"2024年WTT新加坡大满贯女单决赛",questions:[{id:1,videoId:1,question:"这段视频中，孙颖莎的对手是谁？",options:["A. 陈梦","B. 王曼昱","C. 伊藤美诚","D. 王艺迪"],correctAnswer:1,explanation:"这是孙颖莎与王曼昱的精彩对决"}]},{id:2,name:"孙颖莎经典比赛",src:"/videos/sample2.mp4",duration:30,opponent:"2024年仁川冠军赛",matchInfo:"2024年仁川冠军赛",questions:[{id:2,videoId:2,question:"这是孙颖莎的哪场经典比赛？",options:["A. 2024年WTT新加坡大满贯","B. 2024年WTT澳门冠军赛","C. 2024年仁川冠军赛","D. 2024年WTT法兰克福冠军赛"],correctAnswer:2,explanation:"这是2024年仁川冠军赛的精彩对决"}]},{id:3,name:"孙颖莎 vs 田志希",src:"/videos/sample3.mp4",duration:30,opponent:"田志希",matchInfo:"2024年WTT新加坡大满贯女单比赛",questions:[{id:3,videoId:3,question:"这段视频中，孙颖莎的对手是谁？",options:["A. 王曼昱","B. 陈梦","C. 田志希","D. 伊藤美诚"],correctAnswer:2,explanation:"这是孙颖莎与韩国选手田志希的精彩对决"}]},{id:4,name:"孙颖莎的霸王拧",src:"/videos/sample4.mp4",duration:30,opponent:"技术展示",matchInfo:"孙颖莎标志性技术动作",questions:[{id:4,videoId:4,question:"这段视频展示的是孙颖莎的什么标志性技术？",options:["A. 正手拉球","B. 反手拧拉","C. 霸王拧","D. 侧身抢攻"],correctAnswer:2,explanation:"霸王拧是孙颖莎的标志性技术动作，是一种极具威胁性的反手拧拉技术"}]},{id:5,name:"混双：孙颖莎与许昕",src:"/videos/sample5.mp4",duration:30,opponent:"混双搭档",matchInfo:"孙颖莎与许昕混双比赛",questions:[{id:5,videoId:5,question:"这段视频中，孙颖莎的混双搭档是谁？",options:["A. 王楚钦","B. 许昕","C. 樊振东","D. 马龙"],correctAnswer:1,explanation:"这是孙颖莎与许昕的混双比赛，两人曾多次搭档参加国际比赛"}]},{id:6,name:"女双：孙颖莎与王艺迪",src:"/videos/sample6.mp4",duration:30,opponent:"陈梦和王曼昱",matchInfo:"女双比赛：孙颖莎/王艺迪 vs 陈梦/王曼昱",questions:[{id:6,videoId:6,question:"这段视频中，孙颖莎的女双搭档是谁？",options:["A. 陈梦","B. 王曼昱","C. 王艺迪","D. 陈幸同"],correctAnswer:2,explanation:"这是孙颖莎与王艺迪的女双比赛，对手是陈梦和王曼昱"}]},{id:7,name:"孙颖莎 vs 伊藤美诚",src:"/videos/sample7.mp4",duration:30,opponent:"伊藤美诚",matchInfo:"孙颖莎与伊藤美诚的经典对决",questions:[{id:7,videoId:7,question:"这段视频中，孙颖莎的对手是谁？",options:["A. 王曼昱","B. 陈梦","C. 伊藤美诚","D. 王艺迪"],correctAnswer:2,explanation:"这是孙颖莎与日本选手伊藤美诚的经典对决"}]}];function h(){let e=(0,s.useMemo)(()=>{let e=[...m.flatMap((e,t)=>e.questions.map((t,n)=>({question:t,video:e,questionIndex:n})))];for(let t=e.length-1;t>0;t--){let n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e},[]),t=e.length,[n,a]=(0,s.useState)(0),[l,o]=(0,s.useState)(0),[h,x]=(0,s.useState)(!1),[f,p]=(0,s.useState)(!1),[v,w]=(0,s.useState)(new Map),g=(0,s.useRef)(0),b=e[n],y=null==b?void 0:b.video,j=null==b?void 0:b.question,{gameState:N,startGame:M,answerQuestion:A,endGame:E,resetGame:R}=function(e){let[t,n]=(0,s.useState)({isPlaying:!1,currentVideoId:0,currentQuestionIndex:-1,score:0,totalQuestions:e,correctAnswers:0,startTime:0,answeredQuestions:new Set}),r=(0,s.useCallback)(()=>{n({isPlaying:!0,currentVideoId:0,currentQuestionIndex:-1,score:0,totalQuestions:e,correctAnswers:0,startTime:Date.now(),answeredQuestions:new Set})},[e]),a=(0,s.useCallback)((e,t)=>{n(n=>({...n,score:t?n.score+1:n.score,correctAnswers:t?n.correctAnswers+1:n.correctAnswers,answeredQuestions:new Set([...n.answeredQuestions,e])}))},[]),l=(0,s.useCallback)(()=>{n(e=>({...e,isPlaying:!1,endTime:Date.now()}))},[]),o=(0,s.useCallback)(()=>{r()},[r]);return{gameState:t,startGame:r,answerQuestion:a,endGame:l,resetGame:o}}(t);(0,s.useEffect)(()=>{0===N.startTime&&(M(),setTimeout(()=>{p(!0)},1e3))},[M,N.startTime]);let S=()=>{if(n<t-1){let t=n+1;a(t),p(!1),x(!1),g.current+=1;let r=e[t];r&&r.video.id!==(null==y?void 0:y.id)&&o(m.findIndex(e=>e.id===r.video.id)),setTimeout(()=>{p(!0)},500)}else setTimeout(()=>{E()},500)},T=()=>N.startTime?Math.floor(((N.endTime||Date.now())-N.startTime)/1e3):0,C=Array.from(v.entries()).reduce((t,n)=>{let[r,s]=n,a=e.find(e=>e.question.id===r);return a&&a.question.correctAnswer===s?t+1:t},0),I=v.size===t;return y&&j?(0,r.jsxs)("div",{className:"min-h-screen bg-black relative flex flex-col",children:[(0,r.jsx)(d,{score:N.score,totalQuestions:t,elapsedTime:T()}),(0,r.jsxs)("div",{className:"flex-1 relative flex items-center justify-center",children:[(0,r.jsx)(i,{videoSrc:y.src,width:320,height:180,onVideoEnd:()=>{x(!0)}},g.current),!N.isPlaying&&void 0!==N.endTime&&(0,r.jsxs)("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-30 flex gap-4",children:[(0,r.jsx)("button",{onClick:()=>{if(n>0){let t=n-1;a(t),p(!1),x(!1),g.current+=1;let r=e[t];r&&r.video.id!==(null==y?void 0:y.id)&&o(m.findIndex(e=>e.id===r.video.id)),setTimeout(()=>{p(!0)},500)}},disabled:0===n,className:"px-6 py-2 rounded-lg font-bold transition-all ".concat(0===n?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"),children:"← 上一题"}),(0,r.jsx)("button",{onClick:S,disabled:n===t-1,className:"px-6 py-2 rounded-lg font-bold transition-all ".concat(n===t-1?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"),children:"下一题 →"})]})]}),(f||!N.isPlaying&&void 0!==N.endTime)&&j&&(0,r.jsx)("div",{className:"w-full bg-black/90 backdrop-blur-md border-t border-white/10 py-6",children:(0,r.jsx)(c,{question:j,questionIndex:n,totalQuestions:t,isVisible:!0,onAnswer:(e,t)=>{j&&(w(t=>new Map(t).set(j.id,e)),A(j.id,t),setTimeout(()=>{S()},2e3))},onClose:()=>{},previousAnswer:v.get(j.id),isAnswered:v.has(j.id)})}),(0,r.jsx)(u,{isVisible:!N.isPlaying&&void 0!==N.endTime&&I,totalTime:T(),score:N.score,totalQuestions:t,correctAnswers:C,onRestart:()=>{R(),a(0),o(0),x(!1),p(!1),w(new Map),g.current+=1,window.location.reload()}})]}):(0,r.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,r.jsx)("div",{className:"text-white",children:"加载中..."})})}}},function(e){e.O(0,[689,870,971,117,744],function(){return e(e.s=5848)}),_N_E=e.O()}]);