(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[421],{5848:function(e,t,n){Promise.resolve().then(n.bind(n,8862))},8862:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return f}});var r=n(7437),a=n(2265),i=n(2079),s=n(1448);function o(e){if(e.startsWith("http://")||e.startsWith("https://"))return e;let t="";if(!(t=window.__NEXT_PUBLIC_BASE_PATH__||"")){let e=window.__NEXT_DATA__;t=(null==e?void 0:e.assetPrefix)||(null==e?void 0:e.basePath)||""}if(!t&&window.location.pathname){let e=window.location.pathname.match(/^(\/SunYingSha)/);e&&(t=e[1])}let n=e.startsWith("/")?e:"/".concat(e);if(t){let e=t.endsWith("/")&&"/"!==t?t.slice(0,-1):t;return"".concat(e).concat(n)}return n}function l(e){let{videoSrc:t,width:l=320,height:c=180,particleSize:d=2,className:u="",onVideoEnd:m}=e,p=(0,a.useRef)(null),h=(0,a.useRef)(null),f=(0,a.useRef)(null),x=(0,a.useRef)(null),g=(0,a.useRef)(null),v=(0,a.useRef)(null),b=(0,a.useRef)(null),w=(0,a.useRef)(null),y=(0,a.useRef)(),j=(0,a.useRef)(null),E=(0,a.useRef)(null),N=(0,a.useRef)(null),M=(0,a.useRef)(null),I=(0,a.useRef)(null),C=(0,a.useRef)(null),A=(0,a.useRef)(null),R=(0,a.useRef)(null),P=(0,a.useRef)(null),S=(0,a.useRef)(null),T=(0,a.useRef)(0),k=(0,a.useRef)(null),[D,_]=(0,a.useState)(!1),[z,L]=(0,a.useState)(!0),[q,W]=(0,a.useState)(null),[F,G]=(0,a.useState)(!1),[B,O]=(0,a.useState)({width:0,height:0});return(0,a.useEffect)(()=>{let e,t;if(!p.current||!h.current)return;(async()=>{try{let{SelfieSegmentation:e}=await n.e(784).then(n.t.bind(n,4987,23)),t=new e({locateFile:e=>"https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/".concat(e)});t.setOptions({modelSelection:1}),t.onResults(e=>{e.segmentationMask&&(S.current=e.segmentationMask,G(!0),console.log("MediaPipe mask 已更新"))}),P.current=t,console.log("MediaPipe 初始化成功")}catch(e){console.warn("MediaPipe 不可用，将使用基础粒子效果")}})();let r=new i.xsS;f.current=r;let a=l/c;window.innerWidth/window.innerHeight>a?e=Math.floor((t=Math.floor(.5*window.innerHeight*.8))*a):t=Math.floor((e=Math.floor(.5*window.innerWidth*.8))/a),O({width:e=Math.floor(e),height:t=Math.floor(t)});let o=new i.cPb(45,e/t,1,1e3);o.position.z=400,x.current=o;let u=new s.CP7({antialias:!0});u.setSize(e,t),u.setClearColor(0,1),p.current.appendChild(u.domElement),g.current=u;let m=document.createElement("canvas");m.width=l,m.height=c;let D=m.getContext("2d",{willReadFrequently:!0});if(!D){W("无法创建视频 Canvas 上下文");return}j.current=m,E.current=D;let _=document.createElement("canvas");_.width=l,_.height=c;let z=_.getContext("2d",{willReadFrequently:!0});if(!z){W("无法创建 Mask Canvas 上下文");return}N.current=_,M.current=z;let q=Math.floor(e/d),F=Math.floor(t/d),B=q*F;console.log("创建 GPU Shader 粒子系统: ".concat(B," 个粒子 (").concat(q,"x").concat(F,")，Canvas: ").concat(e,"x").concat(t));let H=new i.u9r;b.current=H;let Z=new Float32Array(3*B),U=new Float32Array(3*B),Q=new Float32Array(B),V=new Float32Array(2*B);R.current=V;let X=0;for(let n=0;n<F;n++)for(let r=0;r<q;r++)Z[3*X]=(r/q-.5)*e,Z[3*X+1]=(.5-n/F)*t,Z[3*X+2]=0,V[2*X]=r/q*l,V[2*X+1]=n/F*c,U[3*X]=1,U[3*X+1]=1,U[3*X+2]=1,Q[X]=0,X++;H.setAttribute("position",new i.TlE(Z,3)),H.setAttribute("color",new i.TlE(U,3)),H.setAttribute("aIsPerson",new i.TlE(Q,1)),I.current=U,C.current=Z,A.current=Q,b.current.userData={gridWidth:q,gridHeight:F,count:B};let J=new i.jyz({uniforms:{},vertexShader:"\nattribute float aIsPerson;\n\nvarying vec3 vColor;\nvarying float vIsPerson;\n\nvoid main() {\n  vColor = color;\n  vIsPerson = aIsPerson;\n\n  vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix * mvPosition;\n\n  // 统一粒子尺寸，避免视觉上的颜色变化\n  gl_PointSize = 1.5;\n}\n",fragmentShader:"\nprecision mediump float;\n\nvarying vec3 vColor;\nvarying float vIsPerson;\n\nvoid main() {\n  // 圆形粒子（可选，更柔和）\n  vec2 coord = gl_PointCoord - vec2(0.5);\n  if (dot(coord, coord) > 0.25) discard;\n\n  // 统一透明度，避免颜色视觉变化\n  float alpha = 1.0;\n\n  // 直接使用顶点颜色，不做任何调整\n  gl_FragColor = vec4(vColor, alpha);\n}\n",transparent:!0,depthTest:!0,depthWrite:!1,vertexColors:!0,side:i.ehD});w.current=J;let Y=new i.woe(H,J);r.add(Y),v.current=Y;let K=h.current,$=()=>{console.log("视频数据已加载"),L(!1),W(null)},ee=()=>{L(!1)},et=e=>{let t=K.error,n="视频加载失败，请检查视频路径";if(t)switch(t.code){case t.MEDIA_ERR_ABORTED:n="视频加载被中止";break;case t.MEDIA_ERR_NETWORK:n="网络错误，无法加载视频";break;case t.MEDIA_ERR_DECODE:n="视频解码失败";break;case t.MEDIA_ERR_SRC_NOT_SUPPORTED:n="视频格式不支持"}W(n),L(!1)};async function en(e){if(!e.videoWidth||!P.current)return;let t=performance.now();if(t-T.current>100)try{await P.current.send({image:e}),T.current=t}catch(e){var n,r;((null==e?void 0:null===(n=e.message)||void 0===n?void 0:n.includes("Aborted"))||(null==e?void 0:null===(r=e.message)||void 0===r?void 0:r.includes("Module")))&&(console.warn("MediaPipe 运行时错误，将使用基础粒子效果"),P.current=null)}}K.addEventListener("loadeddata",$),K.addEventListener("canplay",ee),K.addEventListener("error",et),function e(){y.current=requestAnimationFrame(e);let t=E.current,n=x.current,r=g.current,a=f.current,i=b.current;if(r&&a&&n){if(K&&!K.paused&&K.readyState>=2&&en(K),K&&K.readyState>=2&&t&&i&&I.current&&C.current&&A.current)try{var s;t.clearRect(0,0,l,c),t.drawImage(K,0,0,l,c);let e=t.getImageData(0,0,l,c).data,n=null,r=!1;if(k.current){n=new Float32Array(l*c);for(let t=0;t<c;t++)for(let a=0;a<l;a++){let i=(t*l+a)*4,s=Math.abs(e[i]-k.current[i]),o=Math.abs(e[i+1]-k.current[i+1]),c=Math.abs(e[i+2]-k.current[i+2]),d=(s+o+c)/765>.1?1:0;n[t*l+a]=d,1===d&&(r=!0)}}if(n&&!r)return;k.current=new Uint8ClampedArray(e);let a=null,o=M.current;if(S.current&&o){let e=S.current;o.clearRect(0,0,l,c),o.drawImage(e,0,0,l,c),a=o.getImageData(0,0,l,c).data}let d=I.current,u=C.current,m=A.current,p=R.current;if(!p||!i)return;let h=(null===(s=i.userData)||void 0===s?void 0:s.count)||0;if(0===h)return;for(let t=0;t<h;t++){let r=Math.floor(p[2*t]),i=Math.floor(p[2*t+1]),s=Math.max(0,Math.min(r,l-1)),o=Math.max(0,Math.min(i,c-1)),h=(o*l+s)*4;e[h],e[h+1],e[h+2];let f=a&&a[h]>128?1:0;m[t]=f;let x=n?n[o*l+s]:0;1===x?d[3*t]=1:d[3*t]=0,d[3*t+1]=0,d[3*t+2]=0,f>.5?u[3*t+2]=100:u[3*t+2]=-150}if(i.attributes.color.needsUpdate=!0,i.attributes.position.needsUpdate=!0,i.attributes.aIsPerson.needsUpdate=!0,.016>Math.random()&&n){let e=0;for(let t=0;t<n.length;t++)1===n[t]&&e++;console.log("运动检测统计:",{totalParticles:n.length,motionParticles:e,motionRatio:(e/n.length*100).toFixed(1)+"%",motionType:"二值化（0=静止，1=运动）"})}}catch(e){e instanceof Error&&!e.message.includes("cross-origin")&&console.warn("视频帧处理错误:",e)}r.render(a,n)}}();let er=()=>{let e,t;let n=x.current,r=g.current;if(!n||!r)return;let a=l/c;window.innerWidth/window.innerHeight>a?e=Math.floor((t=Math.floor(.5*window.innerHeight*.8))*a):t=Math.floor((e=Math.floor(.5*window.innerWidth*.8))/a),O({width:e=Math.floor(e),height:t=Math.floor(t)}),n.aspect=e/t,n.updateProjectionMatrix(),r.setSize(e,t)};return window.addEventListener("resize",er),()=>{let e=h.current;e&&(e.removeEventListener("loadeddata",$),e.removeEventListener("canplay",ee),e.removeEventListener("error",et),e.pause(),e.src="",e.load()),window.removeEventListener("resize",er),y.current&&cancelAnimationFrame(y.current);let t=E.current,n=M.current;if(t&&t.clearRect(0,0,l,c),n&&n.clearRect(0,0,l,c),u&&u.domElement.parentNode&&u.domElement.parentNode.removeChild(u.domElement),u&&u.dispose(),H&&H.dispose(),J&&J.dispose(),P.current)try{P.current.close()}catch(e){console.warn("关闭分割器失败:",e)}k.current=null,S.current=null}},[l,c,d]),(0,a.useEffect)(()=>{let e=h.current,n=o(t);if(e&&e.src!==n){e.pause(),e.currentTime=0;let t=E.current,r=M.current;t&&t.clearRect(0,0,l,c),r&&r.clearRect(0,0,l,c),k.current=null,S.current=null,L(!0),W(null),_(!1),e.src=n,e.load()}},[t,l,c]),(0,a.useEffect)(()=>{let e=h.current;!e||D||z||q||e.play().catch(e=>{console.warn("自动播放失败，需要用户交互:",e)})},[z,q,D]),(0,a.useEffect)(()=>{let e=h.current;if(!e)return;let t=()=>_(!0),n=()=>_(!1),r=()=>{_(!1),e&&e.pause(),m&&m()};return e.addEventListener("play",t),e.addEventListener("pause",n),e.addEventListener("ended",r),()=>{e.removeEventListener("play",t),e.removeEventListener("pause",n),e.removeEventListener("ended",r)}},[m]),(0,r.jsxs)("div",{className:"relative ".concat(u),style:{width:"".concat(B.width,"px"),height:"".concat(B.height,"px"),margin:"0 auto"},children:[(0,r.jsx)("div",{ref:p,className:"absolute inset-0"}),(0,r.jsx)("video",{ref:h,src:o(t),className:"hidden",muted:!0,playsInline:!0,preload:"auto",autoPlay:!0}),z&&(0,r.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/50 z-10",children:[(0,r.jsx)("div",{className:"text-white text-lg mb-2",children:"加载中..."}),(0,r.jsx)("div",{className:"text-white/60 text-sm",children:"正在初始化 GPU Shader 和 MediaPipe"})]}),q&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 z-10",children:(0,r.jsxs)("div",{className:"text-red-400 text-center px-4",children:[(0,r.jsx)("p",{className:"text-lg mb-2",children:"错误"}),(0,r.jsx)("p",{className:"text-sm",children:q})]})})]})}var c=n(429),d=n(5095);function u(e){let{question:t,questionIndex:n,totalQuestions:i,isVisible:s,onAnswer:o,onClose:l,previousAnswer:u,isAnswered:m=!1}=e,[p,h]=(0,a.useState)(null!=u?u:null),[f,x]=(0,a.useState)(m),[g,v]=(0,a.useState)(!!m&&void 0!==u&&u===t.correctAnswer);(0,a.useEffect)(()=>{s&&(m&&void 0!==u?(h(u),x(!0),v(u===t.correctAnswer)):(h(null),x(!1),v(!1)))},[s,t.id,m,u]);let b=e=>{if(m||null!==p)return;h(e);let n=e===t.correctAnswer;v(n),x(!0),o(e,n)};if(!s)return null;let w=(n+1)/i*100;return(0,r.jsx)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"w-full p-4 md:p-6",children:(0,r.jsxs)("div",{className:"relative bg-gradient-to-br from-white via-blue-50/30 to-purple-50/30 rounded-2xl p-6 md:p-8 max-w-4xl w-full mx-auto shadow-2xl border border-white/50 backdrop-blur-sm",children:[(0,r.jsx)("div",{className:"absolute -inset-1 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 rounded-2xl blur-xl opacity-20 -z-10"}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,r.jsxs)(c.E.span,{initial:{opacity:0},animate:{opacity:1},className:"text-sm font-semibold text-gray-600",children:["问题 ",n+1," / ",i]}),(0,r.jsxs)("span",{className:"text-sm font-semibold text-gray-600",children:[Math.round(w),"%"]})]}),(0,r.jsx)("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,r.jsx)(c.E.div,{initial:{width:0},animate:{width:"".concat(w,"%")},transition:{duration:.5,ease:"easeOut"},className:"h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 rounded-full shadow-lg"})})]}),(0,r.jsx)(c.E.h2,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1},className:"text-2xl md:text-3xl font-bold mb-8 text-gray-800 leading-tight",children:t.question}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:t.options.map((e,n)=>{let a=p===n,i=n===t.correctAnswer,s=a&&!i,o=null!==p||m;return(0,r.jsxs)(c.E.button,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},transition:{delay:.2+.1*n},whileHover:o?{}:{scale:1.02,y:-2},whileTap:o?{}:{scale:.98},onClick:()=>b(n),disabled:o,className:"\n                  relative p-5 rounded-xl text-left font-medium text-lg\n                  transition-all duration-300 overflow-hidden\n                  ".concat(o?"cursor-not-allowed":"cursor-pointer","\n                  ").concat(f?i?"bg-gradient-to-br from-green-400 to-emerald-500 text-white border-2 border-green-500 shadow-lg shadow-green-500/50":s?"bg-gradient-to-br from-red-400 to-rose-500 text-white border-2 border-red-500 shadow-lg shadow-red-500/50":"bg-gray-100 text-gray-500 border-2 border-gray-200 opacity-60":"bg-white hover:bg-gradient-to-br hover:from-blue-50 hover:to-purple-50 text-gray-800 border-2 border-gray-300 hover:border-blue-400 shadow-md hover:shadow-lg","\n                "),children:[a&&!f&&(0,r.jsx)(c.E.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},className:"absolute inset-0 bg-gradient-to-r from-blue-400 to-purple-400 opacity-20 rounded-xl"}),(0,r.jsxs)("span",{className:"relative z-10 flex items-center",children:[(0,r.jsxs)("span",{className:"mr-3 text-2xl",children:[String.fromCharCode(65+n),"."]}),(0,r.jsx)("span",{children:e.replace(/^[A-D]\.\s*/,"")})]}),f&&(0,r.jsx)(c.E.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200},className:"absolute top-2 right-2 text-2xl",children:i?"✓":s?"✗":""})]},n)})}),(0,r.jsx)(d.M,{children:f&&(0,r.jsxs)(c.E.div,{initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.9},transition:{type:"spring",stiffness:200},className:"\n                p-6 rounded-xl shadow-lg border-2\n                ".concat(g?"bg-gradient-to-br from-green-100 to-emerald-100 text-green-800 border-green-300":"bg-gradient-to-br from-red-100 to-rose-100 text-red-800 border-red-300","\n              "),children:[(0,r.jsxs)(c.E.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},className:"flex items-center gap-3 mb-2",children:[(0,r.jsx)("span",{className:"text-3xl",children:g?"\uD83C\uDF89":"\uD83D\uDE14"}),(0,r.jsx)("p",{className:"font-bold text-xl",children:g?(0,r.jsx)("span",{className:"bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent",children:"✓ 回答正确！+1分"}):(0,r.jsxs)("span",{children:["✗ 回答错误，正确答案是：",(0,r.jsx)("span",{className:"text-green-700",children:t.options[t.correctAnswer]})]})})]}),t.explanation&&(0,r.jsx)(c.E.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"mt-3 text-sm md:text-base leading-relaxed",children:t.explanation})]})})]})})}function m(e){let{score:t,totalQuestions:n,elapsedTime:a}=e;return(0,r.jsx)("div",{className:"absolute top-4 right-4 z-30 bg-black/70 backdrop-blur-md rounded-lg p-4 text-white",children:(0,r.jsxs)("div",{className:"flex items-center gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-gray-400 mb-1",children:"得分"}),(0,r.jsxs)("div",{className:"text-2xl font-bold",children:[t,(0,r.jsxs)("span",{className:"text-sm text-gray-400",children:["/",n]})]})]}),(0,r.jsx)("div",{className:"h-12 w-px bg-white/20"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-gray-400 mb-1",children:"时间"}),(0,r.jsx)("div",{className:"text-xl font-bold",children:"".concat(Math.floor(a/60).toString().padStart(2,"0"),":").concat(Math.floor(a%60).toString().padStart(2,"0"))})]})]})})}function p(e){let{isVisible:t,totalTime:n,score:i,totalQuestions:s,correctAnswers:o,onRestart:l}=e,[u,m]=(0,a.useState)(0),[p,h]=(0,a.useState)(0),[f,x]=(0,a.useState)(0),g=s>0?o/s*100:0,v=g>=90?{text:"优秀",stars:"⭐⭐⭐⭐⭐",color:"text-yellow-400",bgGradient:"from-yellow-400 via-orange-500 to-red-500",glowColor:"shadow-yellow-500/50"}:g>=80?{text:"良好",stars:"⭐⭐⭐⭐",color:"text-blue-400",bgGradient:"from-blue-400 via-purple-500 to-pink-500",glowColor:"shadow-blue-500/50"}:g>=60?{text:"一般",stars:"⭐⭐⭐",color:"text-green-400",bgGradient:"from-green-400 via-emerald-500 to-teal-500",glowColor:"shadow-green-500/50"}:{text:"加油",stars:"⭐⭐",color:"text-gray-400",bgGradient:"from-gray-400 via-slate-500 to-gray-600",glowColor:"shadow-gray-500/50"};return((0,a.useEffect)(()=>{if(!t)return;let e=0,n=setInterval(()=>{m(Math.floor(i*(1-Math.pow(1-++e/60,3)))),e>=60&&(m(i),clearInterval(n))},25);e=0;let r=setInterval(()=>{h(Math.floor(o*(1-Math.pow(1-++e/60,3)))),e>=60&&(h(o),clearInterval(r))},25);e=0;let a=setInterval(()=>{x(parseFloat((g*(1-Math.pow(1-++e/60,3))).toFixed(1))),e>=60&&(x(g),clearInterval(a))},25);return()=>{clearInterval(n),clearInterval(r),clearInterval(a)}},[t,i,o,g]),t)?(0,r.jsx)(d.M,{children:(0,r.jsxs)(c.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 opacity-95"}),(0,r.jsx)("div",{className:"absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNmZmYiIGZpbGwtb3BhY2l0eT0iMC4wNSI+PGNpcmNsZSBjeD0iMzAiIGN5PSIzMCIgcj0iMiIvPjwvZz48L2c+PC9zdmc+')] opacity-30"}),(0,r.jsxs)(c.E.div,{initial:{scale:.8,y:50,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.8,opacity:0},transition:{type:"spring",stiffness:300,damping:30,delay:.1},className:"relative bg-gradient-to-br from-white/95 to-white/90 backdrop-blur-xl rounded-3xl p-8 md:p-12 max-w-2xl w-full mx-4 shadow-2xl border border-white/20",children:[(0,r.jsx)("div",{className:"absolute -inset-1 bg-gradient-to-r ".concat(v.bgGradient," rounded-3xl blur-xl opacity-20 -z-10")}),(0,r.jsxs)(c.E.div,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"text-center mb-8",children:[(0,r.jsx)(c.E.h2,{animate:{scale:[1,1.1,1],rotate:[0,5,-5,0]},transition:{duration:.6,repeat:1/0,repeatDelay:2},className:"text-5xl md:text-6xl font-extrabold mb-4 bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 bg-clip-text text-transparent",children:"\uD83C\uDF89 游戏结束 \uD83C\uDF89"}),(0,r.jsx)("p",{className:"text-gray-600 text-lg",children:"恭喜完成挑战！"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[(0,r.jsxs)(c.E.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{delay:.4,type:"spring",stiffness:200},className:"bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl p-6 text-white shadow-lg transform hover:scale-105 transition-transform",children:[(0,r.jsx)("div",{className:"text-sm opacity-90 mb-2",children:"总得分"}),(0,r.jsxs)("div",{className:"text-4xl font-bold",children:[u,(0,r.jsxs)("span",{className:"text-2xl opacity-75",children:["/",s]})]})]}),(0,r.jsxs)(c.E.div,{initial:{scale:0,rotate:180},animate:{scale:1,rotate:0},transition:{delay:.5,type:"spring",stiffness:200},className:"bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl p-6 text-white shadow-lg transform hover:scale-105 transition-transform",children:[(0,r.jsx)("div",{className:"text-sm opacity-90 mb-2",children:"正确率"}),(0,r.jsxs)("div",{className:"text-4xl font-bold",children:[f.toFixed(1),(0,r.jsx)("span",{className:"text-2xl",children:"%"})]})]}),(0,r.jsxs)(c.E.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.6,type:"spring",stiffness:200},className:"bg-gradient-to-br from-orange-500 to-red-600 rounded-2xl p-6 text-white shadow-lg transform hover:scale-105 transition-transform",children:[(0,r.jsx)("div",{className:"text-sm opacity-90 mb-2",children:"正确题数"}),(0,r.jsxs)("div",{className:"text-4xl font-bold",children:[p,(0,r.jsxs)("span",{className:"text-2xl opacity-75",children:["/",s]})]})]}),(0,r.jsxs)(c.E.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.7,type:"spring",stiffness:200},className:"bg-gradient-to-br from-indigo-500 to-blue-600 rounded-2xl p-6 text-white shadow-lg transform hover:scale-105 transition-transform",children:[(0,r.jsx)("div",{className:"text-sm opacity-90 mb-2",children:"总时长"}),(0,r.jsx)("div",{className:"text-4xl font-bold",children:"".concat(Math.floor(n/60).toString().padStart(2,"0"),":").concat(Math.floor(n%60).toString().padStart(2,"0"))})]})]}),(0,r.jsxs)(c.E.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.8},className:"text-center mb-8 p-6 rounded-2xl bg-gradient-to-r ".concat(v.bgGradient," text-white shadow-xl ").concat(v.glowColor," shadow-2xl"),children:[(0,r.jsx)("div",{className:"text-sm opacity-90 mb-2",children:"等级评价"}),(0,r.jsx)(c.E.div,{animate:{scale:[1,1.05,1]},transition:{duration:1,repeat:1/0,repeatDelay:1},className:"text-5xl font-extrabold ".concat(v.color),children:v.text}),(0,r.jsx)("div",{className:"text-3xl mt-2",children:v.stars})]}),(0,r.jsxs)(c.E.button,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:1},whileHover:{scale:1.05},whileTap:{scale:.95},onClick:l,className:"w-full py-4 bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 text-white rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all duration-300 relative overflow-hidden group",children:[(0,r.jsx)("span",{className:"relative z-10",children:"\uD83C\uDFAE 重新开始游戏"}),(0,r.jsx)(c.E.div,{className:"absolute inset-0 bg-gradient-to-r from-red-600 via-pink-600 to-purple-600",initial:{x:"-100%"},whileHover:{x:0},transition:{duration:.3}})]})]})]})}):null}let h=[{id:1,name:"孙颖莎 vs 王曼昱",src:"/videos/sample1.mp4",duration:30,opponent:"王曼昱",matchInfo:"2024年WTT新加坡大满贯女单决赛",questions:[{id:1,videoId:1,question:"这段视频中，孙颖莎的对手是谁？",options:["A. 陈梦","B. 王曼昱","C. 伊藤美诚","D. 王艺迪"],correctAnswer:1,explanation:"这是孙颖莎与王曼昱的精彩对决"}]},{id:2,name:"孙颖莎经典比赛",src:"/videos/sample2.mp4",duration:30,opponent:"2024年仁川冠军赛",matchInfo:"2024年仁川冠军赛",questions:[{id:2,videoId:2,question:"这是孙颖莎的哪场经典比赛？",options:["A. 2024年WTT新加坡大满贯","B. 2024年WTT澳门冠军赛","C. 2024年仁川冠军赛","D. 2024年WTT法兰克福冠军赛"],correctAnswer:2,explanation:"这是2024年仁川冠军赛的精彩对决"}]},{id:3,name:"孙颖莎 vs 田志希",src:"/videos/sample3.mp4",duration:30,opponent:"田志希",matchInfo:"2024年WTT新加坡大满贯女单比赛",questions:[{id:3,videoId:3,question:"这段视频中，孙颖莎的对手是谁？",options:["A. 王曼昱","B. 陈梦","C. 田志希","D. 伊藤美诚"],correctAnswer:2,explanation:"这是孙颖莎与韩国选手田志希的精彩对决"}]},{id:4,name:"孙颖莎的霸王拧",src:"/videos/sample4.mp4",duration:30,opponent:"技术展示",matchInfo:"孙颖莎标志性技术动作",questions:[{id:4,videoId:4,question:"这段视频展示的是孙颖莎的什么标志性技术？",options:["A. 正手拉球","B. 反手拧拉","C. 霸王拧","D. 侧身抢攻"],correctAnswer:2,explanation:"霸王拧是孙颖莎的标志性技术动作，是一种极具威胁性的反手拧拉技术"}]},{id:5,name:"混双：孙颖莎与许昕",src:"/videos/sample5.mp4",duration:30,opponent:"混双搭档",matchInfo:"孙颖莎与许昕混双比赛",questions:[{id:5,videoId:5,question:"这段视频中，孙颖莎的混双搭档是谁？",options:["A. 王楚钦","B. 许昕","C. 樊振东","D. 马龙"],correctAnswer:1,explanation:"这是孙颖莎与许昕的混双比赛，两人曾多次搭档参加国际比赛"}]},{id:6,name:"女双：孙颖莎与王艺迪",src:"/videos/sample6.mp4",duration:30,opponent:"陈梦和王曼昱",matchInfo:"女双比赛：孙颖莎/王艺迪 vs 陈梦/王曼昱",questions:[{id:6,videoId:6,question:"这段视频中，孙颖莎的女双搭档是谁？",options:["A. 陈梦","B. 王曼昱","C. 王艺迪","D. 陈幸同"],correctAnswer:2,explanation:"这是孙颖莎与王艺迪的女双比赛，对手是陈梦和王曼昱"}]},{id:7,name:"孙颖莎 vs 伊藤美诚",src:"/videos/sample7.mp4",duration:30,opponent:"伊藤美诚",matchInfo:"孙颖莎与伊藤美诚的经典对决",questions:[{id:7,videoId:7,question:"这段视频中，孙颖莎的对手是谁？",options:["A. 王曼昱","B. 陈梦","C. 伊藤美诚","D. 王艺迪"],correctAnswer:2,explanation:"这是孙颖莎与日本选手伊藤美诚的经典对决"}]}];function f(){let e=(0,a.useMemo)(()=>{let e=[...h.flatMap((e,t)=>e.questions.map((t,n)=>({question:t,video:e,questionIndex:n})))];for(let t=e.length-1;t>0;t--){let n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e},[]),t=e.length,[n,i]=(0,a.useState)(0),[s,o]=(0,a.useState)(0),[c,d]=(0,a.useState)(!1),[f,x]=(0,a.useState)(!1),[g,v]=(0,a.useState)(new Map),b=(0,a.useRef)(0),w=e[n],y=null==w?void 0:w.video,j=null==w?void 0:w.question,{gameState:E,startGame:N,answerQuestion:M,endGame:I,resetGame:C}=function(e){let[t,n]=(0,a.useState)({isPlaying:!1,currentVideoId:0,currentQuestionIndex:-1,score:0,totalQuestions:e,correctAnswers:0,startTime:0,answeredQuestions:new Set}),r=(0,a.useCallback)(()=>{n({isPlaying:!0,currentVideoId:0,currentQuestionIndex:-1,score:0,totalQuestions:e,correctAnswers:0,startTime:Date.now(),answeredQuestions:new Set})},[e]),i=(0,a.useCallback)((e,t)=>{n(n=>({...n,score:t?n.score+1:n.score,correctAnswers:t?n.correctAnswers+1:n.correctAnswers,answeredQuestions:new Set([...n.answeredQuestions,e])}))},[]),s=(0,a.useCallback)(()=>{n(e=>({...e,isPlaying:!1,endTime:Date.now()}))},[]),o=(0,a.useCallback)(()=>{r()},[r]);return{gameState:t,startGame:r,answerQuestion:i,endGame:s,resetGame:o}}(t);(0,a.useEffect)(()=>{0===E.startTime&&(N(),setTimeout(()=>{x(!0)},1e3))},[N,E.startTime]);let A=()=>{if(n<t-1){let t=n+1;i(t),x(!1),d(!1),b.current+=1;let r=e[t];r&&r.video.id!==(null==y?void 0:y.id)&&o(h.findIndex(e=>e.id===r.video.id)),setTimeout(()=>{x(!0)},500)}else setTimeout(()=>{I()},500)},R=()=>E.startTime?Math.floor(((E.endTime||Date.now())-E.startTime)/1e3):0,P=Array.from(g.entries()).reduce((t,n)=>{let[r,a]=n,i=e.find(e=>e.question.id===r);return i&&i.question.correctAnswer===a?t+1:t},0),S=g.size===t;return y&&j?(0,r.jsxs)("div",{className:"min-h-screen bg-black relative flex flex-col",children:[(0,r.jsx)(m,{score:E.score,totalQuestions:t,elapsedTime:R()}),(0,r.jsxs)("div",{className:"flex-1 relative flex items-center justify-center",children:[(0,r.jsx)(l,{videoSrc:y.src,width:320,height:180,onVideoEnd:()=>{d(!0)}},b.current),!E.isPlaying&&void 0!==E.endTime&&(0,r.jsxs)("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-30 flex gap-4",children:[(0,r.jsx)("button",{onClick:()=>{if(n>0){let t=n-1;i(t),x(!1),d(!1),b.current+=1;let r=e[t];r&&r.video.id!==(null==y?void 0:y.id)&&o(h.findIndex(e=>e.id===r.video.id)),setTimeout(()=>{x(!0)},500)}},disabled:0===n,className:"px-6 py-2 rounded-lg font-bold transition-all ".concat(0===n?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"),children:"← 上一题"}),(0,r.jsx)("button",{onClick:A,disabled:n===t-1,className:"px-6 py-2 rounded-lg font-bold transition-all ".concat(n===t-1?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"),children:"下一题 →"})]})]}),(f||!E.isPlaying&&void 0!==E.endTime)&&j&&(0,r.jsx)("div",{className:"w-full bg-black/90 backdrop-blur-md border-t border-white/10 py-6",children:(0,r.jsx)(u,{question:j,questionIndex:n,totalQuestions:t,isVisible:!0,onAnswer:(e,t)=>{j&&(v(t=>new Map(t).set(j.id,e)),M(j.id,t),setTimeout(()=>{A()},2e3))},onClose:()=>{},previousAnswer:g.get(j.id),isAnswered:g.has(j.id)})}),(0,r.jsx)(p,{isVisible:!E.isPlaying&&void 0!==E.endTime&&S,totalTime:R(),score:E.score,totalQuestions:t,correctAnswers:P,onRestart:()=>{C(),i(0),o(0),d(!1),x(!1),v(new Map),b.current+=1,window.location.reload()}})]}):(0,r.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,r.jsx)("div",{className:"text-white",children:"加载中..."})})}},5095:function(e,t,n){"use strict";n.d(t,{M:function(){return x}});var r=n(2265),a=n(1534);function i(){let e=(0,r.useRef)(!1);return(0,a.L)(()=>(e.current=!0,()=>{e.current=!1}),[]),e}var s=n(8345),o=n(4252),l=n(3576);class c extends r.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function d(e){let{children:t,isPresent:n}=e,a=(0,r.useId)(),i=(0,r.useRef)(null),s=(0,r.useRef)({width:0,height:0,top:0,left:0});return(0,r.useInsertionEffect)(()=>{let{width:e,height:t,top:r,left:o}=s.current;if(n||!i.current||!e||!t)return;i.current.dataset.motionPopId=a;let l=document.createElement("style");return document.head.appendChild(l),l.sheet&&l.sheet.insertRule('\n          [data-motion-pop-id="'.concat(a,'"] {\n            position: absolute !important;\n            width: ').concat(e,"px !important;\n            height: ").concat(t,"px !important;\n            top: ").concat(r,"px !important;\n            left: ").concat(o,"px !important;\n          }\n        ")),()=>{document.head.removeChild(l)}},[n]),r.createElement(c,{isPresent:n,childRef:i,sizeRef:s},r.cloneElement(t,{ref:i}))}let u=e=>{let{children:t,initial:n,isPresent:a,onExitComplete:i,custom:s,presenceAffectsLayout:c,mode:u}=e,p=(0,l.h)(m),h=(0,r.useId)(),f=(0,r.useMemo)(()=>({id:h,initial:n,isPresent:a,custom:s,onExitComplete:e=>{for(let t of(p.set(e,!0),p.values()))if(!t)return;i&&i()},register:e=>(p.set(e,!1),()=>p.delete(e))}),c?void 0:[a]);return(0,r.useMemo)(()=>{p.forEach((e,t)=>p.set(t,!1))},[a]),r.useEffect(()=>{a||p.size||!i||i()},[a]),"popLayout"===u&&(t=r.createElement(d,{isPresent:a},t)),r.createElement(o.O.Provider,{value:f},t)};function m(){return new Map}var p=n(8881),h=n(3223);let f=e=>e.key||"",x=e=>{var t;let{children:n,custom:o,initial:l=!0,onExitComplete:c,exitBeforeEnter:d,presenceAffectsLayout:m=!0,mode:x="sync"}=e;(0,h.k)(!d,"Replace exitBeforeEnter with mode='wait'");let g=(0,r.useContext)(p.p).forceRender||function(){let e=i(),[t,n]=(0,r.useState)(0),a=(0,r.useCallback)(()=>{e.current&&n(t+1)},[t]);return[(0,r.useCallback)(()=>s.Wi.postRender(a),[a]),t]}()[0],v=i(),b=function(e){let t=[];return r.Children.forEach(e,e=>{(0,r.isValidElement)(e)&&t.push(e)}),t}(n),w=b,y=(0,r.useRef)(new Map).current,j=(0,r.useRef)(w),E=(0,r.useRef)(new Map).current,N=(0,r.useRef)(!0);if((0,a.L)(()=>{N.current=!1,function(e,t){e.forEach(e=>{let n=f(e);t.set(n,e)})}(b,E),j.current=w}),t=()=>{N.current=!0,E.clear(),y.clear()},(0,r.useEffect)(()=>()=>t(),[]),N.current)return r.createElement(r.Fragment,null,w.map(e=>r.createElement(u,{key:f(e),isPresent:!0,initial:!!l&&void 0,presenceAffectsLayout:m,mode:x},e)));w=[...w];let M=j.current.map(f),I=b.map(f),C=M.length;for(let e=0;e<C;e++){let t=M[e];-1!==I.indexOf(t)||y.has(t)||y.set(t,void 0)}return"wait"===x&&y.size&&(w=[]),y.forEach((e,t)=>{if(-1!==I.indexOf(t))return;let n=E.get(t);if(!n)return;let a=M.indexOf(t),i=e;i||(i=r.createElement(u,{key:f(n),isPresent:!1,onExitComplete:()=>{y.delete(t);let e=Array.from(E.keys()).filter(e=>!I.includes(e));if(e.forEach(e=>E.delete(e)),j.current=b.filter(n=>{let r=f(n);return r===t||e.includes(r)}),!y.size){if(!1===v.current)return;g(),c&&c()}},custom:o,presenceAffectsLayout:m,mode:x},n),y.set(t,i)),w.splice(a,0,i)}),w=w.map(e=>{let t=e.key;return y.has(t)?e:r.createElement(u,{key:f(e),isPresent:!0,presenceAffectsLayout:m,mode:x},e)}),r.createElement(r.Fragment,null,y.size?w:w.map(e=>(0,r.cloneElement)(e)))}}},function(e){e.O(0,[689,870,429,971,117,744],function(){return e(e.s=5848)}),_N_E=e.O()}]);